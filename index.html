<!DOCTYPE html>
<html class="no-js" lang="en">
  <head>
    <title>Component State Switching</title>

    <meta charset="utf-8" />
    <meta content="Jonic Linley" name="author" />
    <meta
      content="width=device-width, initial-scale=1, viewport-fit=cover"
      name="viewport"
    />
    <link crossorigin href="https://fonts.gstatic.com" rel="preconnect" />
    <link
      as="style"
      href="https://fonts.googleapis.com/css?family=Rubik:300,400,500,700&display=swap"
      rel="preload"
    />
    <link
      href="https://fonts.googleapis.com/css?family=Rubik:300,400,500,700&display=swap"
      media="print"
      onload="this.media='all'"
      rel="stylesheet"
    />
    <noscript>
      <link
        href="https://fonts.googleapis.com/css?family=Rubik:300,400,500,700&display=swap"
        rel="stylesheet"
      />
    </noscript>

    <link href="styles.css" rel="stylesheet" />
    <script defer src="sauce.js"></script>
  </head>

  <body>
    <h1>Component State Switching</h1>

    <div class="card" data-sauce-component data-sauce-state="blue">
      <state media="(min-width: 500px)" value="red" />
      <state media="(min-width: 700px)" value="blue" />
      <state media="(min-width: 900px)" value="green" />
      <state media="(min-width: 1100px)" value="green rounded" />

      Hello, World
    </div>

    <h2>What is this?</h2>

    <p>
      For some initial context, read the discussion on
      <a
        href="https://github.com/RaspberryPiFoundation/sauce-design-system/issues/36"
        >this Github issue</a
      >.
    </p>

    <p>The component above has the following markup:</p>

    <pre><code>&lt;div class="card" data-sauce-component&gt;
  &lt;state media="(min-width: 500px)" value="red" /&gt;
  &lt;state media="(min-width: 700px)" value="blue" /&gt;
  &lt;state media="(min-width: 900px)" value="green" /&gt;
  &lt;state media="(min-width: 1100px)" value="green rounded" /&gt;

  Hello, World
&lt;/div&gt;</code></pre>

    <p>In this example, the box should...</p>

    <ol>
      <li>have a grey border when min-width < 500px</li>
      <li>have a red border when min-width >= 500px</li>
      <li>have a blue border when min-width >= 700px</li>
      <li>have a green border when min-width >= 900px</li>
      <li>have a green, rounded border when min-width >= 1100px</li>
    </ol>

    <h2>How does it work?</h2>

    <p>
      Taking inspiration from the <code>&lt;source&gt;</code> elements in HTML
      specification, I’ve created a “custom” element for
      <code>&lt;state&gt;</code>. It’s not a <em>true</em> custom element,
      because the current spec of the <code>window.customElements</code> API
      would make the HTML required for our purposes too verbose.
    </p>

    <p>
      I’ve also written the JavaScript necessary to observe the
      <code>&lt;state&gt;</code> elements, attach its
      <code>media</code> attributes to the window, and apply their
      <code>value</code> when the <code>media</code> is triggered on the
      <code>window</code>.
    </p>

    <p>
      However, due to the nature of the <code>window.matchMedia</code> API, it’s
      not possible to easily fall back to the other states if one no longer
      applies.
    </p>

    <p>
      With that in mind I’ve written a <code>SauceStateMachine</code> class,
      that allows a component to apply this fallback when a
      <code>&lt;state&gt;</code> no longer applies.
    </p>

    <p>
      In its current state, the script comes in at around 1.3kB after
      minification. Gzip/Brotli compression would allow us to inline this at the
      bottom of our templates with negligable impact on page speed performance.
    </p>

    <p>
      <strong>Please remember this is just a prototype</strong>. Nothing’s been
      decided, and if this is the direction we’re taking, then the code isn’t
      finalised either. I can already think of one optimisation this script
      requires. Furthermore, we couldn’t just go ahead and use this script on
      the JAMstack. We’d need a
      <a href="https://reactjs.org/docs/higher-order-components.html"
        >Higher Order Component</a
      >
      to make this work with the least fuss.
    </p>

    <p>
      Similarly, for Rails we would require a
      <a href="https://github.com/github/view_component">ViewComponent</a> which
      would perform the same job as the React HOC. Using config we can specify
      the behavior of the elements in the page layout, rather than the
      individual component styles.
    </p>

    <p>
      In the absence of React or Rails, a plain-old JS module can be supplied to
      browsers that understand modules. And browsers that don’t support JS
      modules will be considered the "baseline" experience, which is an
      acceptable fallback.
    </p>

    <p>
      And on top of all <em>that</em>, we should also reconsider our use of the
      word “state”, which is already a concept in React. Possible alternatives
      so far:
    </p>

    <ul>
      <li><code>proviso</code></li>
      <li><code>shape</code></li>
      <li><code>mood</code></li>
      <li><code>footing</code></li>
      <li><code>spirit</code></li>
      <li><code>behavior</code></li>
    </ul>

    <h2>Anything to add?</h2>

    <p>
      Please comment on
      <a
        href="https://github.com/RaspberryPiFoundation/sauce-design-system/issues/36"
        >the original Github issue</a
      >, quoting this document where necessary.
    </p>
  </body>
</html>
